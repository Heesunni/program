

## 실행 방법 (Docker 사용)
### 1) `.env` 환경 변수 설정
`.env` 파일을 생성하고, 아래 내용을 추가하기
```ini
DATABASE_URL=postgresql://test:test@db:5432/test
```

### 2) Docker 컨테이너 실행및 확인
```sh
docker-compose up -d
docker ps -a
```

### 3 )`http://localhost:8000` 로 접속하기

---
## 실행 방법 (로컬설치)
### 1) `.env` 환경 변수 설정
`.env` 파일을 생성하고, 아래 내용을 추가하기
```ini
DATABASE_URL=postgresql://test:test@db:5432/test
```

### 2) 가상환경 설치
```sh
python3 -m venv venv
source venv/bin/activate  # macOS/Linux
venv\Scripts\activate     # Windows
```
### 3) 패키지 설치
```sh
pip install -r requirements.txt
```
### 4) FastAPI 서버 실행
```sh
python main.py
```

### 5 )`http://localhost:8000` 로 접속하기

---
##  API 문서 및 테스트방법
#### 1. API문서
[http://localhost:8000/docs](http://localhost:8000/docs)  
위의 실행 방법을 참고하여 파일 실행 후, 페이지에 들어가주세요

#### 2. 테스트방법
1) /user/register 을 통해, 먼저 유저와 어드민 정보를 등록해주세요.
   * grade를 0으로하면 어드민 유저가, 1로하면 일반 유저가 생성됩니다.
   * 테스트를 위해 사전에 만들어 주세요
    ```ini
     ex) 어드민유저 생성 : {"username" : "admin", "grade" : 0}
         일반유저1 생성 : {"username" : "user1", "grade" : 1}
    ```
2) 위의 API문서에 들어가서 [1]에서 생성한 유저정보를 바탕으로 실행하기


---
##  API 구현시 고려했던 사항 및 회고
* ### 기본설계
  * 일반 회원인가 혹은 어드민인가에 따라 결과값이 달라야 해서 해당 부분을 `/user/register`을 통해 유저별 권한을 생성하게 했고, 생성한 유저들을 바탕으로 `/reservations`의 param에 `user_id`값을 받아 이 유저가 어떤 유저인지 확인할 수 있게 하였습니다.
  * 주어진 문제에 최대한 충실하려 노력하였습니다.
  * 누군가 특정 예약건을 수정하려 할 때, 동시에 수정되지 않도록 `trasaction`을 걸고, `for update` 락을 걸어, 다른사람이 `select`는 되지만 `update`는 할 수 없도록 설계하였습니다.

* ### 예약 신청
  * 문제에서, `예약에는 시험일정이 들어가야 한다`고 하였었는데, 이 시험일정이란것이 `시간단위`로 설정할수있는건지 `예약타임(한 세션)별` 설정해야할지 고민을 하다가, `시험시작일정과 종료일정을 시간단위로 자율적으로 선택`할 수 있게 하였습니다.

* ### 예약 수정
  * 예약수정의 경우 어디까지 수정할수 있는가를 고민을 많이했지만, 문제에서 일반회원은 자신들의 예약건들중 확정되지 않은 건들에 한하여 수정할 수 있다하여서, 아직 신청이다 라고 생각하고, 예약 신청시에 필요한값들과 조건들(시험 시작 3일 전까지 신청 가능) 같은것들을 동일시 하려 하였습니다.
  * 어드민의 경우, 일반회원처럼 명확하게 `확정되지 않은`이란 키워드가 없어, 확정과는 상관 없이 수정가능하게 하였지만, 시작일 조건은 일반유저와 같게 하였습니다. 
  * 어드민이 `확정한`예약건수에 대해 수정을 할 수 있어서, 수정시에 동접자가 5만명을 넘어가는지 체크하는 로직에 `확정한` 예약건수 수정시에 변경하려는 예약을 빼고  count 하게 하였습니다.

* ### 예약 확정
  * 예약 확정의 경우, 동접자가 5만명이 넘어가지 않도록 체크하는 로직을 넣었습니다.

* ### 예약 삭제
  * 예약 삭제는 어드민이 나중에 로그확인을 위해 soft delete 방식을 택하였습니다.
  * `delete` method를 사용한 이유는, 직관성을 위해 선택을 하였습니다.

* ### 예약 조회
  * soft delete방식을 선택하였지만, 조회에 있어서만은 삭제된것처럼 취급하고자 `삭제한 예약건수는 나오지 않게` 하였습니다.